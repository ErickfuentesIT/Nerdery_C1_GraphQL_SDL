# ---------------------------------------------------------
# 1. ENUMS
# ---------------------------------------------------------

enum Role {
  MANAGER
  CLIENT
}

enum OrderStatus {
  PENDING
  COMPLETED
  CANCELLED
}

enum PaymentStatus {
  PROCESSING
  SUCCEEDED
  FAILED
  REFUNDED
}

enum TokenType {
  REFRESH
  PASSWORD_RESET
}

# ---------------------------------------------------------
# 2. AUTH AND USER TYPES
# ---------------------------------------------------------

type User {
  id: ID!
  username: String!
  email: String!
  phoneNumber: String
  role: Role!
  isActive: Boolean!
  shippingAddresses: [ShippingAddress!]
  likes: [Like!]
  orders: [Order!]
  cartItems: [CartItem!]
  createdAt: String!
}

type AuthPayload {
  token: String!
  user: User!
}

type SignedUrlResponse {
  signedUrl: String!
  publicId: String!
  contentType: String!
}

# ---------------------------------------------------------
# 3. PRODUCT AND CATALOG CORE
# ---------------------------------------------------------

type Category {
  id: ID!
  name: String!
  products: [Product!]
}

type Product {
  id: ID!
  name: String!
  description: String
  basePrice: Int!
  isActive: Boolean!
  category: Category!
  variants: [ProductVariant!]!
  likes: [Like!]!
  createdAt: String!
  updatedAt: String!
}

type ProductVariant {
  id: ID!
  sku: String!
  stock: Int!
  priceCents: Int!
  isActive: Boolean!
  product: Product!
  images: [Image!]
  variantAttributeCategories: [VariantAttributeCategory!]!
}

type Image {
  id: ID!
  imageUrl: String!
  imageKey: String!
  variant: ProductVariant
}

# ---------------------------------------------------------
# 4. VARIANT ATTRIBUTES
# ---------------------------------------------------------

type Attribute {
  id: ID!
  name: String!
}

type AttributeCategory {
  id: ID!
  value: String!
  attribute: Attribute!
}

type VariantAttributeCategory {
  id: ID!
  variantId: ID!
  attributeCategoryId: ID!
  attributeCategory: AttributeCategory!
}

# ---------------------------------------------------------
# 5. COMMERCE: ORDERS, CART, AND LIKES
# ---------------------------------------------------------

type Order {
  id: ID!
  user: User!
  status: OrderStatus!
  totalAmountCents: Int!
  stripeSessionId: String
  items: [OrderItem!]!
  payment: Payment
  createdAt: String!
}

type OrderItem {
  id: ID!
  variant: ProductVariant!
  quantity: Int!
  priceAtPurchaseCents: Int!
}

type Payment {
  id: ID!
  order: Order!
  stripeId: String!
  amount: Int!
  status: PaymentStatus!
  currency: String!
  createdAt: String!
}

type CartItem {
  id: ID!
  user: User!
  variant: ProductVariant!
  quantity: Int!
}

type Like {
  id: ID!
  user: User!
  product: Product!
  createdAt: String!
}

type ShippingAddress {
  id: ID!
  street: String!
  city: String!
  state: String!
  country: String!
}

# ---------------------------------------------------------
# 6. QUERIES
# ---------------------------------------------------------

type Query {
  # Public Catalog
  products(limit: Int, offset: Int, categoryId: ID): [Product!]!
  product(id: ID!): Product
  categories: [Category!]!
  
  # Attributes
  attributes: [Attribute!]!
  attributeCategories(attributeId: ID!): [AttributeCategory!]!
  
  # Client
  userInformation: User
  myOrders: [Order!]!
  order(id: ID!): Order
  myAddresses: [ShippingAddress!]!
  
  # Manager
  allOrders(status: OrderStatus, userId: ID): [Order!]!
  allUsers: [User!]!
  userAddresses(userId: ID!): [ShippingAddress!]!
}

# ---------------------------------------------------------
# 7. MUTATIONS
# ---------------------------------------------------------

type Mutation {
  # Auth
  signUp(input: SignUpInput!): AuthPayload!
  signIn(input: SignInInput!): AuthPayload!
  signOut: Boolean!
  forgotPassword(email: String!): Boolean!
  resetPassword(input: ResetPasswordInput!): Boolean!

  # Manager: Product Management
  createProduct(input: CreateProductInput!): Product!
  updateProduct(id: ID!, input: UpdateProductInput!): Product!
  deleteProduct(id: ID!): Boolean!
  createProductVariant(input: CreateVariantInput!): ProductVariant!

  # Manager: Attribute Management
  createAttribute(name: String!): Attribute!
  updateAttribute(id: ID!, name: String!): Attribute!
  deleteAttribute(id: ID!): Boolean!
  createAttributeCategory(input: CreateAttributeCategoryInput!): AttributeCategory!
  updateAttributeCategory(id: ID!, value: String!): AttributeCategory!
  deleteAttributeCategory(id: ID!): Boolean!

  # Manager: Media Management
  generateUploadUrl(filename: ID!): SignedUrlResponse!
  insertProductImage(variantId: ID!, publicId: String!): Image!
  deleteProductImage(id: ID!): Image!

  # Client: Engagement And Checkout
  toggleLike(productId: ID!): Like
  createCheckoutSession: String!

  # Client: Cart Management
  addToCart(variantId: ID!, quantity: Int!): CartItem!
  updateCartItemQuantity(id: ID!, quantity: Int!): CartItem!
  removeFromCart(id: ID!): Boolean!

  # Client: Address Management
  createAddress(input: CreateAddressInput!): ShippingAddress!
  updateAddress(id: ID!, input: UpdateAddressInput!): ShippingAddress!
  deleteAddress(id: ID!): Boolean!
}

# ---------------------------------------------------------
# 8. INPUTS
# ---------------------------------------------------------

input SignUpInput {
  username: String!
  email: String!
  password: String!
}

input SignInInput {
  email: String!
  password: String!
}

input ResetPasswordInput {
  token: String!
  newPassword: String!
}

input CreateProductInput {
  name: String!
  description: String
  basePrice: Int!
  categoryId: ID!
  variants: [CreateVariantInput!]
}

input CreateVariantInput {
  sku: String!
  stock: Int!
  priceCents: Int!
  attributeValueIds: [ID!]!
}

input UpdateProductInput {
  name: String
  description: String
  basePrice: Int
  isActive: Boolean
  categoryId: ID
}

input CreateAttributeCategoryInput {
  attributeId: ID!
  value: String!
}

input CreateAddressInput {
  street: String!
  city: String!
  state: String!
  country: String!
}

input UpdateAddressInput {
  street: String
  city: String
  state: String
  country: String
}

# ---------------------------------------------------------
# 9. SCHEMA DEFINITION
# ---------------------------------------------------------

schema {
  query: Query
  mutation: Mutation
}